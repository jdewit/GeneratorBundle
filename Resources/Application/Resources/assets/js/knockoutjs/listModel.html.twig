function {{ entity_cc }}ListModel(options) {
    var self = this;

    self.{{ entity_cc }}s = ko.observableArray(options.{{ entity_cc }}s);
    self.checkAll = ko.observable(false);
    self.filter = ko.observable();
    self.orderBy = ko.observable();
    self.direction = ko.observable();
    self.offset = ko.observable();
    self.limit = ko.observable();

    self.resetSearchForm = function() {
        self.orderBy('updatedAt');
        self.direction('ASC');
        self.offset(0);
        self.limit(20);
    }
    self.resetSearchForm();

    self.searchDialogOptions = ko.observable({});
    self.dialogQueue = $({}); 

    self.new{{ entity }} = function(data, event) { 
        avro.{{ entity_cc }}Model.set{{ entity_cc | ucFirst }}(null); 
    };
    self.edit{{ entity }} = function(data, event) { 
        avro.{{ entity_cc }}Model.set{{ entity_cc | ucFirst }}(data); 
    };

    self.batchEdit = function(data, event) {
        var checked = $('input.selector:checked');
        if (checked.length) {
            if (confirm('Are you sure you want to edit ' + checked.length  + ' {{ entity_cc }}' + (checked.length > 1 ? 's' : '') + '?')) {
                $.each(checked, function() {
                    var id = $(this).val();
                    self.dialogQueue.queue('dialogs', function(next) {
                        {{ entity_cc }} = ko.utils.arrayFirst(self.{{ entity_cc }}s(), function({{ entity_cc }}) {
                            if ({{ entity_cc }}.id == id) {
                                return true;
                            }
                        });
                        if ({{ entity_cc }}) {
                            avro.{{ entity_cc }}Model.set{{ entity_cc | ucFirst }}({{ entity_cc }});
                            avro.{{ entity_cc }}Model.dialogOptions({
                                close: function(event, ui) {
                                    $('input#selector-' + {{ entity_cc }}.id).attr('checked', false);
                                    next();       
                                }
                            });
                        } else {
                            next();
                        }
                    });
                });        
                self.dialogQueue.dequeue('dialogs');
            }
        } else {
            avro.createNotice('No {{ entity_cc }}s were selected');
        }
    };
    self.delete{{ entity }} = function(data, event) { 
        var target = event.currentTarget; 
        var href = target.href; 

        if (confirm("Are you sure you want to delete this {{ entity | camelCaseToTitle }}?")) {
            var target = event.currentTarget;
            var href = target.href; 

            avro.ajax({
                url: href,
                success: function(response){
                    if (response['status'] === 'OK') {
                        avro.createSuccess(response['notice']);
                        self.{{ entity_cc }}s.remove(function({{ entity_cc }}) { return {{ entity_cc }}.id == response['data']['id']; })
                        $(target).closest('.ui-dialog-content').dialog('close');
                    } else {
                        avro.createError(response['notice']);
                    }
                },
            });
        }
    };
    self.batchDelete = function(data, event) {
        var checked = $('input.selector:checked');
        if (checked.length) {
            if (confirm("Are you sure you want to delete these {{ entity_cc | camelCaseToTitle | lower }}s?")) {
                avro.ajax({
                    url: event.currentTarget.href,
                    data: checked,
                    success: function(response){
                        if (response['status'] === 'OK') {
                            avro.createSuccess(response['notice']);
                            checked.each(function() {
                                var id = $(this).val();
                                self.{{ entity_cc }}s.remove(function({{ entity_cc }} ) { return {{ entity_cc }}.id == id; });
                            });
                        } else {
                            avro.createError(response['notice']);
                        }
                    }
                });
            }
        } else {
            avro.createNotice('No {{ entity_cc | camelCaseToTitle | lower }}s selected');
        }
    };
    self.restore{{ entity }} = function(data, event) { 
        var target = event.currentTarget; 
        var href = target.href; 

        avro.ajax({
            url: href,
            success: function(response){
                if (response['status'] === 'OK') {
                    avro.createSuccess(response['notice']);
                    self.{{ entity_cc }}s.remove(function({{ entity_cc }}) { return {{ entity_cc }}.id == response['data']['id']; })
                    $(target).closest('.ui-dialog-content').dialog('close');
                } else {
                    avro.createError(response['notice']);
                }
            }
        });
    };
    self.batchRestore = function(data, event) {
        var checked = $('input.selector:checked');
        if (checked.length) {
            if (confirm("Are you sure you want to restore these {{ entity_cc | camelCaseToTitle | lower }}s?")) {
                href = event.currentTarget.href; 
                avro.ajax({
                    url: href,
                    data: checked,
                    success: function(response){
                        if (response['status']) { 
                            avro.createSuccess(response['notice']);
                            checked.each(function() {
                                var id = $(this).val();
                                self.{{ entity_cc }}s.remove(function({{ entity_cc }}) { return {{ entity_cc }}.id == id; });
                            });
                        } else {
                            avro.createError(response['notice']);
                        }
                    }
                });
            }
        } else {
            avro.createNotice('No {{ entity_cc | camelCaseToTitle | lower }}s selected');
        }
    };

}

