function {{ entity_lc }}Model({{ entity_lc }}) {
    var self = this;
{% for field in fields %}
{% if field.type == 'oneToMany' %}
    self.{{ field.fieldName }} = ko.observableArray();
{% elseif field.type == 'manyToOne' %}
    self.selected{{ field.fieldName|capitalize }} = ko.observable();
    self.available{{ field.fieldName|capitalize }}s = ko.observableArray(available{{ field.fieldName|capitalize }}s);
{% else %}
    self.{{ field.fieldName }} = ko.observable();
{% endif %}
{% endfor %}

    self.{{ entity_lc }}Object.subscribe(function({{ entity_lc }}) {
        if ({{ entity_lc }} != null) {
            self.formAction('{{ "{{ path('"~ bundle_alias ~"_"~ entity_lc ~"_edit', { 'id': "~ entity_lc ~".id }) }}" }}/'+ {{ entity_lc }}.id);
            self.formMode('edit');
{% for field in fields %}
{% if field.type == 'manyToOne' %}
            self.selected{{ field.fieldName|capitalize }}({{ entity_lc }}.{{ field.fieldName }});
{% else %}
            self.{{ field.fieldName }}({{ entity_lc }}.{{ field.fieldName }});
{% endif %}
{% endfor %}
        } else {
            self.formAction('{{ "{{ path('"~ bundle_alias ~"_"~ entity_lc ~"_new') }}" }}');
            self.formMode('new');
        }
    });

    self.{{ entity_lc }}Object( {{ entity_lc }} );
}


